Ομαδική εργασία των: Βίκτωρας Λαμπρόπουλος (sdi...), Ηλίας Δημητρακάκης (sdi2000046).
Για μεταγλώττιση: make, για διαγραφή εκτελέσιμων: make clean
Έχουμε υλοποιήσει όλα τα ζητούμενα της εργασίας, παρακάτω ακολουθεί εξήγηση της λογικής μας και μερικές παραδοχές που έχουμε κάνει.

Περιληπτικά, αρχικοποιούμε τρεις λίστες, όπου στη μια κρατάμε τα κοινά στοιχεία των δύο dirs και στις άλλες δύο τα αρχεία που είναι μοναδικά στο κάθε dir όπως περιγράφεται στην εκφώνηση.
Έπειτα χρησιμοποιούμε τις τρεις αυτές λίστες για να κάνουμε merge στο τρίτο dir.

Για την σύγκριση των dirs:
Για να βρούμε τις διαφορές των καταλόγων,τους διασχίζουμε ταυτόχρονα. Αν βρεθεί κοινός κατάλογος στο επίπεδο που γίνεται η αναζήτηση, μπαίνουμε αναδρομικά σε αυτόν για να συνεχίσουμε την αναζήτηση εκεί. Στην πορεία, εισάγουμε τα αρχεία που βρίσκουμε στις κατάλληλες λίστες (μοναδικά του πρώτου dir, μοναδικά του δεύτερου, κοινά και των δύο).Αν βρεθεί μοναδικό subdir , μπαίνουμε αναδρομικά σε αυτό, έχοντας δώσει τα σωστά ορίσματα στην συνάρτηση, έτσι ώστε να ξέρει ότι οποιουδήποτε είδους αρχείο συναντήσει από εκεί και κάτω, θα πρέπει να το θεωρήσει μοναδικό και να το εισάγει στην κατάλληλη λίστα. Δεν χρειάστηκε να κάνουμε συγκρίσεις για τα σχετικά μονοπάτια, καθώς όταν η συνάρτηση καλείται με δύο ορίσματα στα path αντί για NULL σε κάποιο από τα δύο, βρίσκονται πάντα στο ίδιο μονοπάτι εντός των ιεραρχιών.

Χρησιμοποιούμε τη συνάρτηση scandir αντί των readdir/opendir, καθώς με αυτή επιστρέφονται σε πίνακα όλα τα entries του dir που δώθηκε σαν όρισμα και σε ταξινομομημένη σειρά κατά το όνομα, οπότε οι συγκρίσεις γίνονται πολύ πιο απλές με μια απλή παράλληλη δίασχιση των πινάκων.

Η λίστα που υλοποιήσαμε πρόκειται για μία απλά συνδεδεμένη λίστα με κάθε κόμβο να κρατάει τις βασικές πληροφορίες για κάθε αρχείο: το inode, το μέγεθος, το path, τον τύπο/δικαιώματα, πόσα hardlinks έχει ακόμα, αν πρέπει να γίνει merged και ένα δεύτερο inode, το οποίο εξηγώ παρακάτω σε τι εξυπηρετεί.

Για το merge κομμάτι:
Εντός της λίστας, εκτός από δεδομένα για το κάθε αρχείο υπάρχουν και τα πεδία is_merge και st_inoB.
Το is_merge πεδίο χρησιμοποιείται για να ξέρουμε αν θα βάλουμε το στοιχείο της λίστας στο τελικό dir. Αυτό γιατί αν βρεθούν δύο αρχεία διαφορετικά αλλά με ίδιο όνομα,πρέπει να κάνουμε merge μόνο το πιο πρόσφατο, αλλά πρέπει να εκτυπωθούν και τα δύο σα διαφορετικά, αφού μπαίνουν στις λίστες διαφορών.
Το st_inoB πεδίο χρησιμοποιείται μόνο στην περίπτωση που βρούμε κατά τη σύγκριση δύο αρχεία όμοια και τα δύο έχουν hardlinks. Εκεί θέλουμε να φτιάξουμε στο merged κατάλογο τα hardlinks και των δύο dirs,οπότε πρέπει να ξέρουμε και τα δύο inodes, καθώς μόνο ένα από τα δύο όμοια πρέπει να δημιουργηθεί.
Ως προς τη διαδικασία του merge, ξεκινάμε δημιουργώντας το βασικό dirC και έπειτα με δίασχιση και των τριων λιστών τον γεμίζουμε. Στην περίπτωση που πρέπει να φτιάξουμε αρχεία με hardlinks κάνουμε το εξής:
Αρχικά, έχουμε δύο πίνακες με τα inodes των αρχείων που έχουν ήδη εισαχθεί στον καινούργιο κατάλογο και το path γι αυτά. Κάθε φορά που συναντάμε ένα αρχείο που πρέπει να εισαχθεί και έχει άλλα hardlinks, αρχικά ελέγχουμε αν έχουμε ήδη βάλει άλλο αρχείο με το ίδιο inode. Αν ναι, τότε απλά κάνουμε link σε αυτό. Αν όχι, τότε εισάγουμε το inode του στον πίνακα καθώς και το path για αυτό (αλλαγμένο από dirA/diB σε dirC). Αν το αρχείο που μόλις γράψαμε είχε hardlinks και στα δύο dirs, τότε εισάγουμε και το st_inoB πεδίο του στον πίνακα για να μπορεί να γίνει σωστό linking και από τα δύο dirs.
Σε κάθε άλλη περίπτωση, πρόκειται για μια απλή εναλλαγή του αρχικού dirname με το νέο dirname στο path του αρχείου και αναλόγως τον τύπο, καλούμε την αντίστοιχη συνάρτηση δημιουργίας.


Παραδοχές:
1.Aν κατά τη διάρκεια της σύγκρισης βρούμε δύο αρχεία ίδια σε όλα αλλά το ένα από τα δύο δεν έχει άλλα hardlinks, στη merge κρατάμε αυτό που δεν έχει hardlink, καθώς θεωρήσαμε ότι είναι καλύτερο
να κρατηθεί ένα ξεχωριστό αρχείο παρά το αντίγραφο κάποιου ήδη υπάρχοντος. Για παράδειγμα, αν έχω dirA/B, dirA/h1 διαφορετικά αρχεία και dirB/B ,dirB/h1 hardlinks, με dirA/h1 να είναι το ίδιο αρχείο με dirB/h1 σύμφωνα με την εκφώνηση (ίδιο όνομα, μονοπάτι, μέγεθος, περιεχόμενο), θα κρατήσω το dirA/h1 στο τελικό merged dir.

2.Για την σύγκριση softlinks, πήραμε σαν κριτήριο -όπως είδαμε στο piazza (https://piazza.com/class/lm82yt00xbo4hy/post/125)- ο τελικός στόχος τους να είναι ο ίδιος, καθώς και η διαδρομή που ακολούθησαν για να φτάσουν εκεί. Στην περίπτωση που δεν είναι ίδια, σε οποιοδήποτε βάθος του link chain, κρατάμε το πιο πρόσφατο, δηλαδή στο παράδειγμα από πάνω, τα sakis,takis των δύο dirs είναι διαφορετικά και αν το dirA/Sakis είναι πιο πρόσφατο του dirB/Sakis και το dirΒ/takis είναι πιο πρόσφατο του dirA/takis, στο merged dir η ακολουθία θα είναι η Sakis (του dirA) ->takis (του dirB)->h1.


Σχετικά με τις συναρτήσεις:
Παρακάτω περιγράφονται περιληπτικά οι συναρτήσεις που δημιουργήθηκαν:
Στο path.c:
    construct_path: Δοσμένου ενός path και ενός ονόματος αρχείου, επιστρέφεται η σύνδεση των δύο, δηλαδή το path του αρχείου. Χρησιμοποιείται για να μπορούμε να χρησιμοποιήσουμε την lstat().
    
    canonicalize_path: Δοσμένου ενός path, επιστρέφεται το path έχοντας κάνει resolve substrings όπως "..",".". Χρησιμοποιείται για να ελέγξουμε αν δύο softlinks είναι ίδια.
    
    substitue_path: Δοσμένου ενός path, ενός παλιού dirname και ενός νέου dirname, επιστρέφει το path έχοντας κάνει αντικατάσταση του πρώτου παλιού dirname που βρίσκει με το νέο dirname.         Χρησιμοποιείται κατά τη merge, ώστε να φτιάχουμε τη σωστή τοποθεσία του αρχείου στον καινούργιο κατάλογο.

Στο list.c: 
    Βασικές ενέργειες για τη λίστα, Initialization, Destruction, Insertion.
    Σημείωση 1.: Για κάθε αρχείο κρατάμε το path του εντός του dir στο οποίο βρίσκεται, έτσι στην Print για να έχουμε πανομοιότυπα αποτελέσματα απλά παρακάμπτουμε το όνομα του dir 
        με το strlen(l->dirName)+1.
    Σημείωση 2.: Επειδή έχουμε ως παραδοχή τα κοινά αρχεία να τα κρατάμε από το πρώτο dir, όταν δημιουργούμε τη λίστα για τα κοινά δίνουμε το όνομα του πρώτου dir, έτσι ώστε στη merge να ξέρει
        η συνάρτηση ποιο substring πρέπει να αντικαταστήσει με το καινούργιο.

Στο diff.c: 
    Εκεί κρατάμε τις συναρτήσεις για την σύγκριση και merge.
    filter: Συνάρτηση που παίρνει η scandir ώστε να ξέρει να αγνοήσει τα entries "." και "..".

    files_have_same_content: Συνάρτηση που συγκρίνει τα περιεχόμενα δύο αρχείων.

    absolute_dirname:

    compare_links: Συνάρτηση που συγκρίνει δύο softlinks σύμωνα με την παραδοχή παραπάνω.

    compare_timespec: macro για να βρίσκουμε το πιο πρόσφατο αρχείο, με βάση την πιο πρόσφατη ημερομηνία τροποποίησης (m_time).

    compare: Η αναδρομική συνάρτηση που διασχίζει τα δύο dirs και ενημερώνει κατάλληλα τις τρεις λίστες μας.

    copy_file: Συνάρτηση που αντιγράφει τα περιέχομενα ενός αρχείου σε ένα άλλο.

    merge: Η συνάρτηση ένωσης των δύο αρχικών dirs, όπως περιέγραψα παραπάνω.

    diff: Η συνάρτηση που δημιουργεί τις τρεις λίστες, καλεί την compare και επιστρέφει πίνακα με τις λίστες για να τον πάρει σαν όρισμα η merge.

